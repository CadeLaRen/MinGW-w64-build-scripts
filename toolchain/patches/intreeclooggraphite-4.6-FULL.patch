diff --git a/Makefile.def b/Makefile.def
index cadb709..9c99440 100644
--- a/Makefile.def
+++ b/Makefile.def
@@ -61,7 +61,7 @@ host_modules= { module= gcc; bootstrap=true;
 host_modules= { module= gawk; };
 host_modules= { module= gettext; };
 host_modules= { module= gmp; lib_path=.libs; bootstrap=true;
-		extra_configure_flags='--disable-shared';
+		extra_configure_flags='--disable-shared @extra_gmp_configure_flags@';
 		no_install= true;
 		// none-*-* disables asm optimizations, bootstrap-testing
 		// the compiler more thoroughly.
@@ -76,12 +76,12 @@ host_modules= { module= mpc; lib_path=.libs; bootstrap=true;
 		extra_configure_flags='--disable-shared @extra_mpc_gmp_configure_flags@ @extra_mpc_mpfr_configure_flags@';
 		no_install= true; };
 host_modules= { module= ppl; lib_path=src/.libs; bootstrap=true;
-		extra_configure_flags='--disable-shared --with-libgmp-prefix=$$r/$(HOST_SUBDIR)/gmp/ --with-libgmpxx-prefix=$$r/$(HOST_SUBDIR)/gmp/';
+		extra_configure_flags='--disable-shared --with-gmp-build=$$r/$(HOST_SUBDIR)/gmp/ CPPFLAGS="-I$$r/$(HOST_SUBDIR)/gmp -I$${topdir}/gmp/"';
 		no_install= true; };
 host_modules= { module= cloog; lib_path=.libs; bootstrap=true;
 		extra_configure_flags='--disable-shared --with-gmp-library=$$r/$(HOST_SUBDIR)/gmp/.libs --with-gmp-include=$$r/$(HOST_SUBDIR)/gmp --with-bits=gmp --with-ppl';
-		extra_exports='CPPFLAGS="${CPPFLAGS} ${HOST_PPLINC}"; export CPPFLAGS; LDFLAGS="$$LDFLAGS ${HOST_PPLLIBS}"; export LDFLAGS; ';
-		extra_make_flags='CPPFLAGS="${CPPFLAGS} ${HOST_PPLINC}" LDFLAGS="$$LDFLAGS"';
+		extra_exports='CPPFLAGS="${CPPFLAGS} -I$$r/$(HOST_SUBDIR)/gmp ${HOST_PPLINC}"; export CPPFLAGS; LDFLAGS="$$LDFLAGS -L$$r/$(HOST_SUBDIR)/gmp/.libs ${HOST_PPLLIBS}"; export LDFLAGS; ';
+		extra_make_flags='CPPFLAGS="${CPPFLAGS} -I$$r/$(HOST_SUBDIR)/gmp ${HOST_PPLINC}" LDFLAGS="$$LDFLAGS -L$$r/$(HOST_SUBDIR)/gmp/.libs"';
 		no_install= true; };
 host_modules= { module= libelf; lib_path=.libs; bootstrap=true;
 		extra_configure_flags='--disable-shared';
diff --git a/Makefile.in b/Makefile.in
index 132f9df..62e533b 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -16848,7 +16848,7 @@ configure-gmp:
 	libsrcdir="$$s/gmp"; \
 	$(SHELL) $${libsrcdir}/configure \
 	  $(HOST_CONFIGARGS) --build=${build_alias} --host=none-${host_vendor}-${host_os} \
-	  --target=none-${host_vendor}-${host_os} $${srcdiroption} --disable-shared \
+	  --target=none-${host_vendor}-${host_os} $${srcdiroption} --disable-shared --enable-cxx \
 	  || exit 1
 @endif gmp
 
@@ -19473,7 +19473,7 @@ configure-ppl:
 	libsrcdir="$$s/ppl"; \
 	$(SHELL) $${libsrcdir}/configure \
 	  $(HOST_CONFIGARGS) --build=${build_alias} --host=${host_alias} \
-	  --target=${target_alias} $${srcdiroption} --disable-shared --with-libgmp-prefix=$$r/$(HOST_SUBDIR)/gmp/ --with-libgmpxx-prefix=$$r/$(HOST_SUBDIR)/gmp/ \
+	  --target=${target_alias} $${srcdiroption} --disable-shared --with-gmp-build=$$r/$(HOST_SUBDIR)/gmp/ CPPFLAGS="-I$$r/$(HOST_SUBDIR)/gmp -I$${topdir}/gmp/" \
 	  || exit 1
 @endif ppl
 
@@ -20336,7 +20336,7 @@ configure-cloog:
 	s=`cd $(srcdir); ${PWD_COMMAND}`; export s; \
 	test ! -f $(HOST_SUBDIR)/cloog/Makefile || exit 0; \
 	$(SHELL) $(srcdir)/mkinstalldirs $(HOST_SUBDIR)/cloog ; \
-	$(HOST_EXPORTS) CPPFLAGS="${CPPFLAGS} ${HOST_PPLINC}"; export CPPFLAGS; LDFLAGS="$$LDFLAGS ${HOST_PPLLIBS}"; export LDFLAGS;  \
+	$(HOST_EXPORTS) CPPFLAGS="${CPPFLAGS} -I$$r/$(HOST_SUBDIR)/gmp ${HOST_PPLINC}"; export CPPFLAGS; LDFLAGS="$$LDFLAGS -L$$r/$(HOST_SUBDIR)/gmp/.libs ${HOST_PPLLIBS}"; export LDFLAGS;  \
 	echo Configuring in $(HOST_SUBDIR)/cloog; \
 	cd "$(HOST_SUBDIR)/cloog" || exit 1; \
 	case $(srcdir) in \
@@ -20348,7 +20348,7 @@ configure-cloog:
 	libsrcdir="$$s/cloog"; \
 	$(SHELL) $${libsrcdir}/configure \
 	  $(HOST_CONFIGARGS) --build=${build_alias} --host=${host_alias} \
-	  --target=${target_alias} $${srcdiroption} --disable-shared --with-gmp-library=$$r/$(HOST_SUBDIR)/gmp/.libs --with-gmp-include=$$r/$(HOST_SUBDIR)/gmp --with-bits=gmp --with-ppl \
+	  --target=${target_alias} $${srcdiroption} --disable-shared LDFLAGS="-L$$r/$(HOST_SUBDIR)/gmp/.libs" CPPFLAGS="-I$$r/$(HOST_SUBDIR)/gmp" --with-bits=gmp --with-ppl \
 	  || exit 1
 @endif cloog
 
@@ -20571,9 +20571,9 @@ maybe-all-cloog: all-cloog
 all-cloog: configure-cloog
 	@r=`${PWD_COMMAND}`; export r; \
 	s=`cd $(srcdir); ${PWD_COMMAND}`; export s; \
-	$(HOST_EXPORTS) CPPFLAGS="${CPPFLAGS} ${HOST_PPLINC}"; export CPPFLAGS; LDFLAGS="$$LDFLAGS ${HOST_PPLLIBS}"; export LDFLAGS;  \
+	$(HOST_EXPORTS) CPPFLAGS="${CPPFLAGS} -I$$r/$(HOST_SUBDIR)/gmp ${HOST_PPLINC}"; export CPPFLAGS; LDFLAGS="$$LDFLAGS -I$$r/$(HOST_SUBDIR)/gmp ${HOST_PPLLIBS}"; export LDFLAGS;  \
 	(cd $(HOST_SUBDIR)/cloog && \
-	  $(MAKE) $(BASE_FLAGS_TO_PASS) $(EXTRA_HOST_FLAGS) CPPFLAGS="${CPPFLAGS} ${HOST_PPLINC}" LDFLAGS="$$LDFLAGS" \
+	  $(MAKE) $(BASE_FLAGS_TO_PASS) $(EXTRA_HOST_FLAGS) CPPFLAGS="${CPPFLAGS} -I$$r/$(HOST_SUBDIR)/gmp ${HOST_PPLINC}" LDFLAGS="$$LDFLAGS -I$$r/$(HOST_SUBDIR)/gmp" \
 		$(TARGET-cloog))
 @endif cloog
 
diff --git a/configure b/configure
index b3cc9ad..51444ba 100755
--- a/configure
+++ b/configure
@@ -5708,16 +5708,15 @@ if test "x$with_ppl_lib" != x; then
 fi
 
 if test x"$with_ppl$with_ppl_include$with_ppl_lib" = x && test -d ${srcdir}/ppl; then
-  if test x"$enable_watchdog" = xyes; then
-    pwllib="-lpwl"
-  fi
-  ppllibs='-L$$r/$(HOST_SUBDIR)/ppl/interfaces/C/'"$lt_cv_objdir"' -L$$r/$(HOST_SUBDIR)/ppl/src/'"$lt_cv_objdir"
+  pwllib="-lpwl"
+  ppllibs='-L$$r/$(HOST_SUBDIR)/ppl/interfaces/C/'"$lt_cv_objdir"' -L$$r/$(HOST_SUBDIR)/ppl/src/'"$lt_cv_objdir"' -L$$r/$(HOST_SUBDIR)/ppl/Watchdog/src/'"$lt_cv_objdir"
   pplinc='-I$$r/$(HOST_SUBDIR)/ppl/src -I$$r/$(HOST_SUBDIR)/ppl/interfaces/C '
   enable_ppl_version_check=no
   with_ppl=yes
 fi
 
 if test "x$with_ppl" != xno; then
+  extra_gmp_configure_flags='--enable-cxx'
   if test "x$pwllib" = x; then
     saved_LDFLAGS="$LDFLAGS"
     LDFLAGS="$LDFLAGS $ppllibs"
@@ -5892,10 +5891,43 @@ if test "x$with_ppl" = "xno"; then
 fi
 if test "x${with_cloog}" = x && test "x${with_cloog_include}" = x \
   && test "x${with_cloog_lib}" = x && test -d ${srcdir}/cloog; then
-  clooglibs='-L$$r/$(HOST_SUBDIR)/cloog/'"$lt_cv_objdir"' '
+  clooglibs='-L$$r/$(HOST_SUBDIR)/cloog/.libs '
   clooginc='-I$$r/$(HOST_SUBDIR)/cloog/include -I$$s/cloog/include '
+  cloogintree='yes'
+  if test "${gcc_cv_cloog_type+set}" != set; then :
+    case $cloog_backend in
+      "ppl-legacy")
+        gcc_cv_cloog_type="PPL Legacy"
+        clooginc="${clooginc}"
+        clooglibs="${clooglibs} -lcloog"
+        cloog_org=no
+        ;;
+      "isl")
+        gcc_cv_cloog_type="ISL"
+        clooginc="${clooginc} -DCLOOG_INT_GMP -DCLOOG_ORG"
+        clooglibs="${clooglibs} "'-L$$r/$(HOST_SUBDIR)/cloog/isl/.libs'" -lcloog-isl -lisl"
+        cloog_org=yes
+        ;;
+      "ppl")
+        gcc_cv_cloog_type="PPL"
+        clooginc="${clooginc} -DCLOOG_INT_GMP -DCLOOG_ORG"
+        clooglibs="${clooglibs} -lcloog-ppl"
+        cloog_org=yes
+        ;;
+      *)
+        gcc_cv_cloog_type=""
+        clooglibs=
+        clooginc=
+        cloog_org=
+        ;;
+    esac
+  fi
+  # enable graphite for in-tree cloog if ppl was found
+  if test "x${pplinc}" != x && test "x{$ppllibs}" != x && test "x${clooginc}" != x && test "x{$clooglibs}" != x; then : 
+    graphite_requested=yes
+  fi
 fi
-if test "x$with_cloog" != "xno"; then
+if test "x$with_cloog" != "xno" && test "x${cloogintree}" != 'xyes'; then
 
 
 
diff --git a/configure.ac b/configure.ac
index c6615bd..d9734c9 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1666,6 +1666,7 @@ if test x"$with_ppl$with_ppl_include$with_ppl_lib" = x && test -d ${srcdir}/ppl;
   ppllibs='-L$$r/$(HOST_SUBDIR)/ppl/interfaces/C/'"$lt_cv_objdir"' -L$$r/$(HOST_SUBDIR)/ppl/src/'"$lt_cv_objdir"
   pplinc='-I$$r/$(HOST_SUBDIR)/ppl/src -I$$r/$(HOST_SUBDIR)/ppl/interfaces/C '
   enable_ppl_version_check=no
+  extra_gmp_configure_flags='--enable-cxx'
   with_ppl=yes
 fi
 
